<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Thanh toán VietQR - Techcombank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0b1120;
      --card: #020617;
      --card-soft: #0f172a;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-soft: #1f2937;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color: var(--text-main);
    }
    .shell {
      max-width: 460px;
      margin: 0 auto;
    }
    .card {
      background: linear-gradient(145deg, var(--card) 0%, #020617 60%, #020617 100%);
      border-radius: 20px;
      padding: 18px 16px 18px;
      border: 1px solid var(--border-soft);
      box-shadow:
        0 18px 45px rgba(0,0,0,0.65),
        0 0 0 1px rgba(148, 163, 184, 0.03);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .brand-logo {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #f97316 0, #e11d48 25%, #4f46e5 70%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: #f9fafb;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.6);
    }
    .brand-text-main {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: var(--text-main);
    }
    .brand-text-sub {
      font-size: 11px;
      color: var(--text-muted);
    }
    .badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-muted);
      backdrop-filter: blur(10px);
      background: rgba(15,23,42,0.7);
    }

    .section {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.18) 0, rgba(15,23,42,0.9) 36%, #020617 80%);
      border-radius: 14px;
      padding: 12px 12px 10px;
      border: 1px solid rgba(148, 163, 184, 0.15);
      margin-bottom: 12px;
      position: relative;
      overflow: hidden;
    }
    .section::after {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(56,189,248,0.08) 0, transparent 50%),
        radial-gradient(circle at 100% 0, rgba(147,51,234,0.09) 0, transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }
    .section-inner {
      position: relative;
      z-index: 1;
    }

    .acc-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: rgba(209, 213, 219, 0.8);
      margin-bottom: 6px;
    }
    .acc-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }
    .acc-main {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.08em;
      color: #f9fafb;
    }
    .acc-name {
      margin-top: 2px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: rgba(229, 231, 235, 0.82);
    }
    .acc-bank {
      margin-top: 4px;
      font-size: 11px;
      color: rgba(209, 213, 219, 0.76);
    }
    .acc-tag {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }
    .acc-tag-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
    }

    .qr-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 10px;
    }
    .qr-box {
      width: 116px;
      height: 116px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 0, rgba(148,163,184,0.2), #020617 55%);
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .qr-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .qr-placeholder {
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      padding: 0 8px;
    }
    .qr-info {
      flex: 1;
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.5;
    }
    .qr-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.5);
      margin-bottom: 6px;
      font-size: 11px;
      color: #e5e7eb;
    }
    .qr-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(56,189,248,0.25);
    }

    .section-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: rgba(209,213,219,0.8);
    }
    .section-mini {
      font-size: 11px;
      color: var(--text-muted);
    }

    .bank-search {
      margin-bottom: 8px;
    }
    .bank-search-input {
      width: 100%;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15,23,42,0.85);
      color: var(--text-main);
      font-size: 12px;
      outline: none;
    }
    .bank-search-input::placeholder {
      color: rgba(156, 163, 175, 0.85);
    }

    .bank-list {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
      max-height: 280px;
      overflow-y: auto;
    }
    .bank-item {
      text-align: center;
      padding: 8px 4px 6px;
      border-radius: 12px;
      background: rgba(15,23,42,0.88);
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease, border 0.12s ease;
      border: 1px solid rgba(30,64,175,0.35);
      box-shadow: 0 8px 16px rgba(15,23,42,0.45);
    }
    .bank-item:hover {
      background: rgba(15,23,42,1);
      border-color: rgba(56,189,248,0.7);
      box-shadow: 0 10px 20px rgba(15,23,42,0.7);
      transform: translateY(-2px);
    }
    .bank-logo-wrap {
      width: 32px;
      height: 32px;
      margin: 0 auto 4px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, rgba(248,250,252,0.6) 0, rgba(15,23,42,1) 55%);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid rgba(148,163,184,0.4);
      overflow: hidden;
    }
    .bank-logo {
      width: 24px;
      height: 24px;
      object-fit: contain;
    }
    .bank-name-short {
      font-size: 11px;
      font-weight: 600;
      color: #e5e7eb;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .bank-name-full {
      font-size: 9px;
      color: rgba(156,163,175,0.88);
      height: 24px;
      overflow: hidden;
    }

    .footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
    }
  </style>
</head>
<body>
<div class="shell">
  <div class="card">
    <div class="card-header">
      <div class="brand">
        <div class="brand-logo">Q</div>
        <div>
          <div class="brand-text-main">VietQR Gateway</div>
          <div class="brand-text-sub">Techcombank • Napas 247</div>
        </div>
      </div>
      <span class="badge">One-tap bank transfer</span>
    </div>

    <div class="section">
      <div class="section-inner">
        <div class="acc-title">Tài khoản nhận</div>
        <div class="acc-row">
          <div>
            <div class="acc-main">4445 5566 6001</div>
            <div class="acc-name">NGO MAI NGUYEN DUONG</div>
            <div class="acc-bank">Techcombank • BIN 970407</div>
          </div>
          <div class="acc-tag">
            <span class="acc-tag-dot"></span>
            VietQR Active
          </div>
        </div>

        <div class="qr-wrapper">
          <div class="qr-box">
            <img id="qrImage" class="qr-img" alt="Đang tạo mã VietQR..." />
          </div>
          <div class="qr-info">
            <div class="qr-pill">
              <span class="qr-dot"></span>
              Scan QR để chuyển khoản
            </div>
            <div>QR được tạo tự động mỗi lần mở trang. Mở trang trên điện thoại, chọn logo ngân hàng, hệ thống sẽ cố gắng mở thẳng ứng dụng ngân hàng của bạn.</div>
          </div>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-inner">
        <div class="section-title-row">
          <div class="section-title">Chọn ngân hàng</div>
          <div class="section-mini">VietQR • Napas 247</div>
        </div>

        <div class="bank-search">
          <input
            id="bankSearch"
            class="bank-search-input"
            placeholder="Tìm ngân hàng theo tên hoặc mã (VCB, MBB, ACB...)"
          />
        </div>

        <div id="bankList" class="bank-list">
          Đang tải danh sách ngân hàng...
        </div>
      </div>
    </div>

    <div class="footer-note">
      Mẹo: Lưu trang này thành shortcut trên màn hình chính để khách chuyển khoản nhanh như ví điện tử.
    </div>
  </div>
</div>

<script>
  // ===== 1. TÀI KHOẢN CỐ ĐỊNH =====
  const FIXED_ACCOUNT_NO   = "444555666001";
  const FIXED_ACCOUNT_NAME = "NGO MAI NGUYEN DUONG";
  const FIXED_ACQ_ID       = "970407";
  const FIXED_ADD_INFO     = "CHUYEN KHOAN CHO DUONG";
  const FIXED_AMOUNT       = "";

  // ===== 2. CẤU HÌNH API VIETQR =====
  const VIETQR_CLIENT_ID = " d2ec01e1-3340-406e-8382-71b70f951b66";     // TODO: thay bằng Client Id thật
  const VIETQR_API_KEY  = " 2e454c88-2638-48e3-81b0-1a86842b71dd";      // TODO: thay bằng API Key thật
  const STATIC_QR_IMAGE_URL = "";  // nếu không dùng API, gán ảnh QR tĩnh vào đây

  // ===== 3. API URL =====
  const GENERATE_QR_API = "https://api.vietqr.io/v2/generate";
  const BANK_LIST_API   = "https://api.vietqr.io/v2/banks";

  // ===== 4. QR AUTO =====
  async function autoGenerateQR() {
    const qrImage = document.getElementById("qrImage");

    if ((!VIETQR_CLIENT_ID || !VIETQR_API_KEY) && STATIC_QR_IMAGE_URL) {
      qrImage.src = STATIC_QR_IMAGE_URL;
      qrImage.alt = "Mã VietQR";
      return;
    }

    if (!VIETQR_CLIENT_ID || !VIETQR_API_KEY) {
      qrImage.alt = "Chưa cấu hình API VietQR hoặc ảnh QR tĩnh.";
      return;
    }

    const payload = {
      accountNo:   FIXED_ACCOUNT_NO,
      accountName: FIXED_ACCOUNT_NAME,
      acqId:       FIXED_ACQ_ID,
      format:      "image",
      template:    "compact"
    };
    if (FIXED_AMOUNT)   payload.amount  = FIXED_AMOUNT;
    if (FIXED_ADD_INFO) payload.addInfo = FIXED_ADD_INFO;

    try {
      qrImage.src = "";
      qrImage.alt = "Đang tạo mã VietQR...";

      const res = await fetch(GENERATE_QR_API, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-client-id": VIETQR_CLIENT_ID,
          "x-api-key": VIETQR_API_KEY
        },
        body: JSON.stringify(payload)
      });
      const json = await res.json();
      if (!json || json.code !== "00") {
        console.error(json);
        qrImage.alt = "Tạo VietQR thất bại";
        return;
      }
      qrImage.src = json.data.qrDataURL;
      qrImage.alt = "Mã VietQR";
    } catch (e) {
      console.error(e);
      qrImage.alt = "Lỗi gọi API VietQR";
    }
  }

  // ===== 5. DANH SÁCH NGÂN HÀNG + TÌM KIẾM =====
  let allBanks = [];

  function getAppCodeFromBank(bank) {
    if (bank.code) return bank.code.toLowerCase();
    if (bank.shortName) return bank.shortName.toLowerCase();
    return "";
  }

  function renderBanks(filterText = "") {
    const bankListDiv = document.getElementById("bankList");
    bankListDiv.innerHTML = "";

    const q = filterText.trim().toLowerCase();

    allBanks
      .filter(b => b.transferSupported === 1)
      .filter(b => {
        if (!q) return true;
        const hay = (b.name || "") + " " + (b.shortName || "") + " " + (b.code || "");
        return hay.toLowerCase().includes(q);
      })
      .forEach(bank => {
        const appCode = getAppCodeFromBank(bank);
        if (!appCode) return;

        const item = document.createElement("div");
        item.className = "bank-item";

        const logoWrap = document.createElement("div");
        logoWrap.className = "bank-logo-wrap";

        const logo = document.createElement("img");
        logo.className = "bank-logo";
        logo.src = bank.logo;
        logo.alt = bank.shortName || bank.name || "Bank";

        logoWrap.appendChild(logo);

        const shortName = document.createElement("div");
        shortName.className = "bank-name-short";
        shortName.textContent = bank.shortName || bank.code;

        const fullName = document.createElement("div");
        fullName.className = "bank-name-full";
        fullName.textContent = bank.name;

        item.appendChild(logoWrap);
        item.appendChild(shortName);
        item.appendChild(fullName);

        item.onclick = () => {
          const url = "https://dl.vietqr.io/pay?app=" + encodeURIComponent(appCode);
          window.open(url, "_blank");
        };

        bankListDiv.appendChild(item);
      });

    if (!bankListDiv.children.length) {
      bankListDiv.textContent = "Không tìm thấy ngân hàng phù hợp.";
    }
  }

  async function loadBanks() {
    const bankListDiv = document.getElementById("bankList");
    bankListDiv.textContent = "Đang tải danh sách ngân hàng...";

    try {
      const res = await fetch(BANK_LIST_API);
      const json = await res.json();
      if (!json || !json.data) {
        bankListDiv.textContent = "Không lấy được dữ liệu ngân hàng.";
        return;
      }
      allBanks = json.data;
      renderBanks();
    } catch (e) {
      console.error(e);
      bankListDiv.textContent = "Lỗi khi tải danh sách ngân hàng.";
    }
  }

  document.getElementById("bankSearch").addEventListener("input", (e) => {
    renderBanks(e.target.value);
  });

  autoGenerateQR();
  loadBanks();
</script>
</body>
</html>
      max-width: 260px;
    }

    /* Bank grid gọn + icon */
    .bank-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 10px;
      max-height: 420px;
      overflow-y: auto;
      margin-top: 8px;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #eee;
    }
    .bank-item {
      text-align: center;
      padding: 8px 4px;
      border-radius: 8px;
      background: #f9fafb;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }
    .bank-item:hover {
      background: #e3f2fd;
      box-shadow: 0 0 4px rgba(0,0,0,0.08);
      transform: translateY(-1px);
    }
    .bank-logo {
      width: 32px;
      height: 32px;
      object-fit: contain;
      border-radius: 6px;
      background: #fff;
      border: 1px solid #eee;
      margin-bottom: 4px;
    }
    .bank-name-short {
      font-size: 11px;
      font-weight: 600;
      color: #0d47a1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .bank-name-full {
      font-size: 10px;
      color: #555;
      height: 24px;
      overflow: hidden;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Thanh toán qua VietQR</h1>

  <p class="note">
    Tài khoản nhận cố định: <br/>
    STK: <b>444555666001</b> – Ngân hàng Techcombank (BIN 970407)<br/>
    CTK: <b>NGÔ MAI NGUYÊN DƯƠNG</b> (CTK: NGO MAI NGUYEN DUONG)<br/>
    Vui lòng mở trang này bằng điện thoại để chọn logo ngân hàng và nhảy qua app.
  </p>

  <div class="qr-section">
    <h3>Mã VietQR</h3>
    <img id="qrImage" class="qr-img" alt="Đang tạo mã VietQR..." />
    <p class="note">
      QR được tạo tự động khi tải trang. Nếu không dùng API VietQR, có thể thay bằng ảnh QR tĩnh ngân hàng cấp sẵn.
    </p>
  </div>

  <div class="banks-section">
    <h3>Chọn ngân hàng để mở app</h3>
    <p class="note">
      Nhấn vào logo ngân hàng bạn dùng. Khi truy cập bằng điện thoại, hệ thống sẽ cố gắng mở app tương ứng (deeplink VietQR).
    </p>
    <div id="bankList" class="bank-list">
      Đang tải danh sách ngân hàng...
    </div>
  </div>
</div>

<script>
  // ===== 1. TÀI KHOẢN CỐ ĐỊNH CỦA BẠN =====
  const FIXED_ACCOUNT_NO   = "444555666001";           // STK
  const FIXED_ACCOUNT_NAME = "NGO MAI NGUYEN DUONG";   // không dấu, in hoa
  const FIXED_ACQ_ID       = "970407";                 // BIN Techcombank
  const FIXED_ADD_INFO     = "CHUYEN KHOAN CHO DUONG"; // nội dung
  const FIXED_AMOUNT       = "";                       // để "" cho khách tự nhập tiền trong app

  // ===== 2. CẤU HÌNH API VIETQR (CẦN THAY THẬT Ở ĐÂY) =====
  const VIETQR_CLIENT_ID = "d2ec01e1-3340-406e-8382-71b70f951b66";   // <--- NHÉT CLIENT_ID VÀO ĐÂY
  const VIETQR_API_KEY  = "2e454c88-2638-48e3-81b0-1a86842b71dd";    // <--- NHÉT API_KEY VÀO ĐÂY

  // Nếu không muốn dùng API (chỉ dùng ảnh QR tĩnh), bạn có thể gán trực tiếp:
  const STATIC_QR_IMAGE_URL = ""; // ví dụ: "https://your-domain.com/qr-techcom-444555666001.png"

  // ===== 3. URL API =====
  const GENERATE_QR_API = "https://api.vietqr.io/v2/generate";
  const BANK_LIST_API   = "https://api.vietqr.io/v2/banks";

  // ===== 4. TỰ TẠO MÃ VIETQR KHI LOAD TRANG =====
  async function autoGenerateQR() {
    const qrImage = document.getElementById("qrImage");

    // Trường hợp không dùng API VietQR, chỉ dùng ảnh QR tĩnh
    if ((!VIETQR_CLIENT_ID || !VIETQR_API_KEY) && STATIC_QR_IMAGE_URL) {
      qrImage.src = STATIC_QR_IMAGE_URL;
      qrImage.alt = "Mã VietQR (ảnh tĩnh)";
      return;
    }

    // Nếu chưa cấu hình API và cũng chưa có ảnh tĩnh thì báo
    if (!VIETQR_CLIENT_ID || !VIETQR_API_KEY) {
      qrImage.alt = "Chưa cấu hình API VietQR hoặc ảnh QR tĩnh.";
      return;
    }

    const payload = {
      accountNo:   FIXED_ACCOUNT_NO,
      accountName: FIXED_ACCOUNT_NAME,
      acqId:       FIXED_ACQ_ID,
      format:      "image",
      template:    "compact"
    };

    if (FIXED_AMOUNT)   payload.amount  = FIXED_AMOUNT;
    if (FIXED_ADD_INFO) payload.addInfo = FIXED_ADD_INFO;

    try {
      qrImage.src = "";
      qrImage.alt = "Đang tạo mã VietQR...";

      const res = await fetch(GENERATE_QR_API, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-client-id": VIETQR_CLIENT_ID,
          "x-api-key": VIETQR_API_KEY
        },
        body: JSON.stringify(payload)
      });

      const json = await res.json();
      if (json.code !== "00") {
        console.error(json);
        qrImage.alt = "Tạo VietQR thất bại: " + (json.desc || "Lỗi không xác định");
        return;
      }

      qrImage.src = json.data.qrDataURL;
      qrImage.alt = "Mã VietQR";
    } catch (e) {
      console.error(e);
      qrImage.alt = "Lỗi gọi API VietQR, xem console để biết thêm chi tiết.";
    }
  }

  // ===== 5. LẤY DANH SÁCH NGÂN HÀNG + ICON, RENDER GRID =====
  function getAppCodeFromBank(bank) {
    // Ưu tiên code (VD: VCB, MBB, TCB...), fallback shortName
    if (bank.code) return bank.code.toLowerCase();
    if (bank.shortName) return bank.shortName.toLowerCase();
    return "";
  }

  async function loadBanks() {
    const bankListDiv = document.getElementById("bankList");
    bankListDiv.textContent = "Đang tải danh sách ngân hàng...";

    try {
      const res = await fetch(BANK_LIST_API);
      const json = await res.json();

      if (!json || !json.data) {
        bankListDiv.textContent = "Không lấy được dữ liệu ngân hàng.";
        return;
      }

      bankListDiv.innerHTML = "";

      json.data
        .filter(b => b.transferSupported === 1)
        .forEach(bank => {
          const appCode = getAppCodeFromBank(bank);
          if (!appCode) return;

          const item = document.createElement("div");
          item.className = "bank-item";

          const logo = document.createElement("img");
          logo.className = "bank-logo";
          logo.src = bank.logo;
          logo.alt = bank.shortName || bank.name || "Bank";

          const shortName = document.createElement("div");
          shortName.className = "bank-name-short";
          shortName.textContent = bank.shortName || bank.code;

          const fullName = document.createElement("div");
          fullName.className = "bank-name-full";
          fullName.textContent = bank.name;

          item.appendChild(logo);
          item.appendChild(shortName);
          item.appendChild(fullName);

          item.onclick = () => {
            const url = "https://dl.vietqr.io/pay?app=" + encodeURIComponent(appCode);
            window.open(url, "_blank");
          };

          bankListDiv.appendChild(item);
        });
    } catch (e) {
      console.error(e);
      bankListDiv.textContent = "Lỗi khi tải danh sách ngân hàng.";
    }
  }

  // ===== 6. TỰ CHẠY KHI MỞ TRANG =====
  autoGenerateQR();
  loadBanks();
</script>
</body>
</html>

          btn.href = "https://dl.vietqr.io/pay?app=" + encodeURIComponent(appCode);
          btn.target = "_blank";
          btn.rel = "noopener noreferrer";

          bankListDiv.appendChild(btn);
        });
    } catch (e) {
      console.error(e);
      bankListDiv.textContent = "Lỗi khi tải danh sách ngân hàng.";
    }
  }

  // Tự chạy khi mở trang
  autoGenerateQR();
  loadBanks();
</script>
</body>
</html>
